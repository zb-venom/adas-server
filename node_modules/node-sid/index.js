module.exports = function(options) {
  var SEED = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTOVWXYZ';
  var prefix = options && options.prefix;
  var headerfield = options && options.headerfield || 'x-lb-supid';
  var olen = options && options.len || 6;

  var generate = function(len) {
    var retVal = '';
    for (var i = 0; i < len; i++) {
      retVal += SEED.charAt(Math.floor(Math.random() * SEED.length));
    }
    return retVal;
  }

  /*
   Usage as a module
  */
  this.create = function(prefix,len) {
    if (prefix) return prefix + '_' + generate(len || olen);
    return generate(len || olen);
  }

  /**
   Usage as connect middleware in an express-app
  */
  this.middleware = function(req,res,next) {
    //if header already set append, if not create it from scratch
    if (req.headers[headerfield]) req.headers[headerfield] += '.' + this.create();
    else {
      req.headers[headerfield] = this.create();
    }
    next();
  }

  return this;  
}
